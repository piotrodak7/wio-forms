{
    "FormName": "Form1",
    "Version": "2016",
    "Subversion": 11,
    "VersionId": "2016.11",
    "FormId": "Form1.2016.11",

    "DataRepositories":
    {
        "stanowiska":
        {
            "type": "local",
            "data":
            {
                "rada": "Członek rady",
                "lider": "Lider"
            }
        },
        "akcje":
        {
            "type": "local",
            "data":
            {
                "SZP": "Szlachetna Paczka",
                "AP": "Akademia Przyszłości"
            }
        },
        "login_register_switch":
        {
            "type": "local",
            "data":
            {
                "have_account": "Mam konto",
                "new_account": "Zakładam nowe konto"
            }
        },
        "gender":
        {
            "type": "local",
            "data":
            {
                "female": "Kobieta",
                "male": "Mężczyzna"
            }
        },
        "wioUsers":
        {
            "type": "foreign",
            "data": false,
            "class": "WioUsersData",
            "requiredFields":
            {
                "email": "login_email",
                "password": "login_password"
            }
        }
    },

    "FieldValidatorsPHP":
    {
        "NotEmpty":
        {
            "class": "NotEmpty"
        },
        "Email":
        {
            "class": "Email"
        },
        "Password":
        {
            "class": "Password_v1"
        },
        "ReCaptcha":
        {
            "class": "ReCaptcha"
        },
        "Date":
        {
            "class": "Date"
        }
    },
    "FieldValidatorsJS": {},

    "ContainerValidatorsPHP":
    {
        "AllFieldsOk":
        {
            "class": "AllFieldsOk"
        },
        "FormSaverOk":
        {
            "class": "FormSaverOk"
        }
    },
    "ContainerValidatorsJS": {},


    "Fields":
    {
        "akcja":
        {
            "type": "Select",
            "container": "Site1",
            "position": 1,
            "title": "Akcja",
            "state": 0,
            "save": true,
            "dataSet":
            {
                "repositoryName": "akcje"
            },
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ]
        },
        "stanowisko":
        {
            "type": "Select",
            "container": "Site1",
            "position": 2,
            "title": "Stanowisko",
            "state": 0,
            "save": true,
            "dataSet":
            {
                "repositoryName": "stanowiska"
            },
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ]
        },
        "miejsce_na_mapie":
        {
            "type": "GoogleMap",
            "container": "Site2",
            "position": 1,
            "title": "Miejsce",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ]
        },
        "login_switch":
        {
            "type": "ChooseOneButton",
            "container": "Site3",
            "position": 1,
            "title": "Wybierz opcję",
            "state": 0,
            "save": true,
            "dataSet":
            {
                "repositoryName": "login_register_switch"
            },
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ]

        },
        "account_id":
        {
            "type": "Hidden",
            "container": "LoginForm",
            "position": 3,
            "title": "AccountId",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "NotEmpty",
                    "newErrorMessage": "no_account"
                }
            ]
        },
        "login_email":
        {
          "type": "TextInput",
          "container": "LoginForm",
          "position": 1,
          "title": "Email",
          "state": 0,
          "save": true,
          "validationPHP":
          [
              {
                  "method": "NotEmpty"
              },
              {
                  "method": "Email"
              }
          ]
        },
        "login_password":
        {
            "type": "PasswordInput",
            "container": "LoginForm",
            "position": 2,
            "title": "Hasło",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ]
        },
        "register_login":
        {
          "type": "TextInput",
          "container": "RegisterEmail",
          "position": 1,
          "title": "Email",
          "state": 0,
          "save": true,
          "validationPHP":
          [
              {
                  "method": "Email"
              },
              {
                  "method": "NotEmpty"
              }
          ]
        },
        "register_login2":
        {
          "type": "TextInput",
          "container": "RegisterEmail",
          "position": 2,
          "title": "Powtórz E-mail",
          "state": 0,
          "save": true,
          "validationPHP":
          [
              {
                  "method": "Email"
              },
              {
                  "method": "NotEmpty"
              }
          ]
        },
        "register_password":
        {
            "type": "PasswordInput",
            "container": "RegisterPassword",
            "position": 1,
            "title": "Hasło",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "Password"
                },
                {
                    "method": "NotEmpty"
                }
            ]
        },
        "register_password2":
        {
            "type": "PasswordInput",
            "container": "RegisterPassword",
            "position": 2,
            "title": "Powtórz Hasło",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "Password"
                },
                {
                    "method": "NotEmpty"
                }
            ]
        },
        "register_captcha":
        {
            "type": "GoogleReCaptcha",
            "container": "RegisterForm",
            "position": 3,
            "title": "Wypełnij Captche",
            "state": 0,
            "save": false,
            "validationPHP":
            [
                {
                    "method": "ReCaptcha"
                }
            ]
        },
        "register_name":
        {
            "type": "TextInput",
            "container": "RegisterData",
            "position": 1,
            "title": "Imię",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ],
            "defaultValue":
            {
                "repositoryName": "wioUsers",
                "subset": ["imie"]
            }
        },
        "register_surname":
        {
            "type": "TextInput",
            "container": "RegisterData",
            "position": 2,
            "title": "Nazwisko",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ],
            "defaultValue":
            {
                "repositoryName": "wioUsers",
                "subset": ["nazwisko"]
            }
        },
        "register_date":
        {
            "type": "DatePicker",
            "container": "RegisterData",
            "position": 3,
            "title": "Wiek",
            "state": 0,
            "save": true,
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                },
                {
                    "method": "Date"
                }
            ],
            "defaultValue":
            {
                "repositoryName": "wioUsers",
                "subset": ["pesel"],
                "converter": "Pesel2Date"
            }
        },
        "register_gender":
        {
            "type": "Select",
            "container": "RegisterData",
            "position": 4,
            "title": "Płeć",
            "state": 0,
            "save": true,
            "dataSet":
            {
                "repositoryName": "gender"
            },
            "validationPHP":
            [
                {
                    "method": "NotEmpty"
                }
            ],
            "defaultValue":
            {
                "repositoryName": "wioUsers",
                "subset": ["plec"],
                "converter": "Sex2Gender"
            }
        },
        "agreement_1":
        {
            "type": "AgreementWithText",
            "container": "RegisterData",
            "position": 5,
            "title": "Zgoda na przetwarzanie danych",
            "state": 0,
            "save": true,
            "longer_text": "Bla Bla Bal Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla Bla",
            "validationPHP":
            [
                {
                    "method": "NotEmpty",
                    "newErrorMessage": "agreement_reguired"
                }
            ]
        },
        "agreement_2":
        {
            "type": "AgreementWithText",
            "container": "RegisterData",
            "position": 6,
            "title": "Zgoda na zakładanie kont",
            "state": 0,
            "save": true,
            "longer_text": "Burk Burk Burk Bruk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk Burk ",
            "validationPHP":
            [
                {
                    "method": "NotEmpty",
                    "newErrorMessage": "agreement_reguired"
                }
            ]
        }
    },

    "Containers":
    {
        "Site1":
        {
            "site": 0,
            "container": "_site",
            "position": 1,
            "displayType": "FullDisplay",
            "title": "Podstawowe dane - site:0"
        },
        "Site2":
        {
          "site": 1,
          "container": "_site",
          "position": 1,
          "displayType": "FullDisplay",
          "title": "Podstawowe dane - main:1",
          "validationPHP":
          [
              {
                  "type": "method",
                  "method": "AllFieldsOk",
                  "settings":
                  {
                      "containerToCheck": "_site_0"
                  }
              }
          ],
          "stateActions":
          [
              {
                  "state": -1,
                  "actions": ["hide"]
              },
              {
                  "state": 1,
                  "actions": ["show"]
              }
          ]
        },
        "Site3":
        {
            "site": 2,
            "container": "_site",
            "position": 1,
            "displayType": "FullDisplay",
            "title": "Wybór - logowanie vs. rejestracja",
            "validationPHP":
            [
                {
                    "type": "method",
                    "method": "AllFieldsOk",
                    "settings":
                    {
                        "containerToCheck": "_site_1"
                    }
                }
            ],
            "stateActions":
            [
                {
                    "state": -1,
                    "actions": ["hide"]
                },
                {
                    "state": 1,
                    "actions": ["show"]
                }
            ]
        },
        "Site4":
        {
            "site": 3,
            "container": "_site",
            "position": 1,
            "displayType": "FullDisplay",
            "title": "Mini Formularz",
            "validationPHP":
            [
                {
                    "type": "method",
                    "method": "AllFieldsOk",
                    "settings":
                    {
                        "containerToCheck": "_site_2"
                    }
                }
            ],
            "stateActions":
            [
                {
                    "state": -1,
                    "actions": ["hide"]
                },
                {
                    "state": 1,
                    "actions": ["show"]
                }
            ]
        },
        "Site5":
        {
            "site": 4,
            "container": "_site",
            "position": 1,
            "displayType": "FullDisplay",
            "title": "Dziękujemy za wypełnienie formularza",
            "validationPHP":
            [
                {
                    "type": "method",
                    "method": "FormSaverOk",
                    "settings":
                    {
                        "formSaverToCheck": "finalSave"
                    }
                }
            ],
            "stateActions":
            [
                {
                    "state": -1,
                    "actions": ["hide"]
                },
                {
                    "state": 1,
                    "actions": ["show"]
                }
            ]
        },
        "LoginForm":
        {
            "site": 3,
            "container": "Site4",
            "position": 1,
            "displayType": "FullDisplay",
            "title": "Logowanie",
            "validationPHP":
            [
                {
                    "type": "method",
                    "method": "AllFieldsOk",
                    "settings":
                    {
                        "containerToCheck": "_site_2"
                    }
                },
                {
                    "type": "logic",
                    "newState": 1,
                    "newErrorState": -1,
                    "logicEquation":
                    {
                        "type": "and",
                        "data":
                        [
                            {
                                "type": "equal",
                                "data":
                                [
                                    {
                                        "type": "fieldValue",
                                        "field": "login_switch"
                                    },
                                    {
                                        "type": "const",
                                        "const": "have_account"
                                    }
                                ]
                            },
                            {
                                "type": "isNotSuccessRepository",
                                "repository": "wioUsers"
                            }
                        ]
                    }
                }
            ],
            "stateActions":
            [
                {
                    "state": -1,
                    "actions": ["hide"]
                },
                {
                    "state": 1,
                    "actions": ["show"]
                }
            ]
        },
        "RegisterForm":
        {
          "site": 3,
          "container": "Site4",
          "position": 2,
          "displayType": "FullDisplay",
          "title": "Rejestracja",
          "validationPHP":
          [
              {
                  "type": "method",
                  "method": "AllFieldsOk",
                  "newErrorState": -2,
                  "settings":
                  {
                      "containerToCheck": "_site_2"
                  }
              },
              {
                  "type": "logic",
                  "newState": 1,
                  "newErrorState": -2,
                  "logicEquation":
                  {
                      "type": "equal",
                      "data":
                      [
                          {
                              "type": "fieldValue",
                              "field": "login_switch"
                          },
                          {
                              "type": "const",
                              "const": "new_account"
                          }
                      ]
                  }
              },
              {
                  "type": "method",
                  "method": "AllFieldsOk",
                  "settings":
                  {
                      "containerToCheck": "RegisterForm"
                  }
              }
          ],
          "stateActions":
          [
              {
                  "state": -2,
                  "actions": ["hide"]
              },
              {
                  "state": -1,
                  "actions": ["show"]
              },
              {
                  "state": 1,
                  "actions": ["show"]
              }
          ]
        },
        "RegisterEmail":
        {
            "site": 3,
            "container": "RegisterForm",
            "position": 1,
            "displayType": "FullDisplay",
            "title": "Adres Email",
            "validationPHP":
            [
                {
                    "type": "logic",
                    "newState": 1,
                    "newErrorState": -1,
                    "newErrorMessage": "emails_not_equal",
                    "logicEquation":
                    {
                        "type": "equal",
                        "data":
                        [
                            {
                                "type": "fieldValue",
                                "field": "register_login"
                            },
                            {
                                "type": "fieldValue",
                                "field": "register_login2"
                            }
                        ]
                    }
                }
            ]
        },
        "RegisterPassword":
        {
            "site": 3,
            "container": "RegisterForm",
            "position": 2,
            "displayType": "FullDisplay",
            "title": "Haslo",
            "validationPHP":
            [
                {
                    "type": "logic",
                    "newState": 1,
                    "newErrorState": -1,
                    "newErrorMessage": "passwords_not_equal",
                    "logicEquation":
                    {
                        "type": "equal",
                        "data":
                        [
                            {
                                "type": "fieldValue",
                                "field": "register_password"
                            },
                            {
                                "type": "fieldValue",
                                "field": "register_password2"
                            }
                        ]
                    }
                }
            ]
        },
        "RegisterData":
        {
            "site": 3,
            "container": "Site4",
            "position": 3,
            "displayType": "FullDisplay",
            "title": "Dane zgłoszenia",
            "validationPHP":
            [
                {
                    "type": "method",
                    "newErrorState": -2,
                    "method": "AllFieldsOk",
                    "settings":
                    {
                        "containerToCheck": "_site_2"
                    }
                },
                {
                    "type": "logic",
                    "newState": 1,
                    "newErrorState": -2,
                    "logicEquation":
                    {
                        "type": "or",
                        "data":
                        [
                            {
                                "type": "equal",
                                "data":
                                [
                                    {
                                        "type": "fieldValue",
                                        "field": "login_switch"
                                    },
                                    {
                                        "type": "const",
                                        "const": "new_account"
                                    }
                                ]
                            },
                            {
                                "type": "isSuccessRepository",
                                "repository": "wioUsers"
                            }
                        ]
                    }
                },
                {
                    "type": "method",
                    "method": "AllFieldsOk",
                    "settings":
                    {
                        "containerToCheck": "RegisterData"
                    }
                }
            ],
            "stateActions":
            [
                {
                    "state": -2,
                    "actions": ["hide"]
                },
                {
                    "state": -1,
                    "actions": ["show"]
                },
                {
                    "state": 1,
                    "actions": ["show"]
                }
            ]
        },
        "SubmitButton1":
        {
            "site": 0,
            "container": "Site1",
            "position": 4,
            "displayType": "Button1",
            "title": "Dalej - site:0"

        },
        "TopPoints2":
        {
            "site": 1,
            "container": "Site2",
            "position": 2,
            "displayType": "FullDisplay",
            "title": "TopPoints2 - main:1"
        },
        "SubmitButton2":
        {
            "site": 1,
            "container": "Site2",
            "position": 4,
            "displayType": "Button1",
            "title": "Dalej - site:1"
        },
        "SubmitButton3":
        {
            "site": 3,
            "container": "Site4",
            "position": 4,
            "displayType": "Button1",
            "title": "Wyślij formularz"
        }
    },

    "FormSavers":
    {
        "finalSave":
        {

            "clearTemporarySave": true,
            "validationPHP":
            [
                {
                    "type": "logic",
                    "logicEquation":
                    {
                        "type": "and",
                        "data":
                        [
                            {
                                "type": "isValidContainer",
                                "container": "Site2"
                            },
                            {
                                "type": "isValidContainer",
                                "container": "Site3"
                            },
                            {
                                "type": "isValidContainer",
                                "container": "Site4"
                            },
                            {
                                "type": "or",
                                "data":
                                [
                                    {
                                        "type": "and",
                                        "data":
                                        [
                                            {
                                                "type": "equal",
                                                "data":
                                                [
                                                    {
                                                        "type": "fieldValue",
                                                        "field": "login_switch"
                                                    },
                                                    {
                                                        "type": "const",
                                                        "const": "new_account"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "isValidContainer",
                                                "container": "RegisterForm"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "isSuccessRepository",
                                        "repository": "wioUsers"
                                    }
                                ]
                            },
                            {
                                "type": "isValidContainer",
                                "container": "RegisterData"

                            }
                        ]
                    }
                }
            ],
            "DatabaseSaves":
            [
                {
                    "type": "insert",
                    "databaseConnection": "Main",
                    "tableName": "wio_users",
                    "validationPHP":
                    [
                        {
                            "type": "logic",
                            "logicEquation":
                            {
                                "type": "equal",
                                "data":
                                [
                                    {
                                        "type": "fieldValue",
                                        "field": "login_switch"
                                    },
                                    {
                                        "type": "const",
                                        "const": "have_account"
                                    }
                                ]
                            }
                        }

                    ],
                    "fields":
                    {
                        "email":
                        {
                            "type": "field",
                            "field": "login_email"
                        },
                        "password":
                        {
                            "type": "field",
                            "field": "login_password",
                            "converter": "Password2Hash"
                        }
                    }
                },
                {
                    "type": "insert",
                    "databaseConnection": "Main",
                    "tableName": "wio_users",
                    "validationPHP":
                    [
                        {
                            "type": "logic",
                            "logicEquation":
                            {
                                "type": "equal",
                                "data":
                                [
                                    {
                                        "type": "fieldValue",
                                        "field": "login_switch"
                                    },
                                    {
                                        "type": "const",
                                        "const": "new_account"
                                    }
                                ]
                            }
                        }
                    ],
                    "fields":
                    {
                        "email":
                        {
                            "type": "field",
                            "field": "register_login"
                        },
                        "password":
                        {
                            "type": "field",
                            "field": "register_password",
                            "converter": "Password2Hash"
                        }
                    }
                },
                {
                    "type": "insert",
                    "databaseConnection": "Main",
                    "tableName": "user_basic_data",
                    "fields":
                    {
                        "wio_user_id":
                        {
                            "type": "insertedId",
                            "table": "wio_users"
                        },
                        "wio_flow_id":
                        {
                            "type": "const",
                            "const": "1"
                        },
                        "name":
                        {
                            "type": "field",
                            "field": "register_name"
                        },
                        "surname":
                        {
                            "type": "field",
                            "field": "register_surname"
                        },
                        "gender":
                        {
                            "type": "field",
                            "field": "register_gender"
                        },
                        "birth_date":
                        {
                            "type": "field",
                            "field": "register_date",
                            "converter": "DatePicker2DateTime"
                        }
                    }
                }
            ]
        }
    }
}
